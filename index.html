<!DOCTYPE html>
<html lang="en" dir="auto" prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <title>Tuwa - Web Player</title>
    <meta name="application-name" content="Tuwa">
    <meta name="apple-mobile-web-app-title" content="Tuwa">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="description" content="Listen to premium content with distraction-free viewing. A brand of Tuwa Media.">
    <meta name="author" content="Tuwa Media">
    <link rel="manifest" href="manifest.json">
    <link type="text/plain" rel="author" href="humans.txt" />

    <meta property="og:site_name" content="Tuwa">
    <meta property="og:title" content="Tuwa - Web Player: Sight for everyone">
    <meta property="og:description" content="Listen to premium content with distraction-free viewing. A brand of Tuwa Media.">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://Quran-lite.pages.dev/social-preview.png"> 
    <meta property="og:image" content="assets/og-image.jpg"> <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "SoftwareApplication",
      "name": "Tuwa",
      "alternateName": "Tuwa Audio",
      "headline": "Sight for everyone",
      "operatingSystem": "Web, iOS, Android",
      "applicationCategory": "MusicApplication",
      "genre": "Music & Audio",
      "description": "Premium content platform with distraction-free viewing. A brand of Tuwa Media.",
      "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD",
    "availability": "https://schema.org/InStock"
  },
      "author": {
        "@type": "Organization",
        "name": "Tuwa Media",
        "url": "https://www.Quran-lite.pages.dev"
      },
      "copyrightHolder": {
        "@type": "Organization",
        "name": "Tuwa Media"
      },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "ratingCount": "32000000"
  },
  "downloadUrl": "https://www.Quran-lite.pages.dev/download"
}
    }
    </script>
<script>
window.addEventListener('DOMContentLoaded', () => {
    // Check for "chapter" in the URL (handles ?chapter= and ?chapter)
    const urlParams = new URLSearchParams(window.location.search);
    
    if (urlParams.has('regex')) {
        const brandElements = document.querySelectorAll('.app-brand');
        
        brandElements.forEach(el => {
            // Using !important to override the 'display: flex' in your CSS
            el.style.setProperty('display', 'none', 'important');
        });
        
        // Optional: Console log to verify it triggered
        console.log('Chapter detected: .app-brand hidden.');
    }
});
</script>
    
    <link rel="canonical" id="dynamic-canonical" href="https://Quran-lite.pages.dev">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://everyayah.com">
    <link rel="preconnect" href="https://raw.githubusercontent.com">
    <link rel="icon" type="image/png" sizes="128x128" href="assets/ui/web.png">
<link rel="shortcut icon" href="assets/ui/web.ico">
<link rel="apple-touch-icon" href="assets/ui/apple-touch-icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;900&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    </noscript>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    <script src="src/ui/error-handling-img.js"></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PDWXFDCQRH"></script>
    <link id="main-css" rel="stylesheet" href="styles/index1.css" fetchpriority="high">
    <link id="custom-select-css" rel="stylesheet" href="styles/custom-select.css" fetchpriority="high"> <link rel="stylesheet" href="styles/arabic-modal.css">
    <link rel="stylesheet" href="styles/user-select.css">
    <link rel="stylesheet" href="styles/inline-styles.css">
    <script src="src/utils/i18n-loader.js"></script>
    <script src="src/utils/analytics.js"></script>
    <script src="src/utils/github-redirect.js"></script>
<script> 
(function() {
    const css = `
      #_universal_loader {
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background-color: #000000;
        z-index: 2147483647;
        opacity: 1;
        /* Background fades out slightly slower so we see the light show */
        transition: opacity 0.8s ease-out 0.2s; 
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
       
      .wave-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        height: 9000000000000000000000000000000px;
        transform-origin: center center;
        /* The Zoom Transition:
           We use a cubic-bezier that starts slow and snaps fast (The "Punch")
        */
        transition: 
            transform 1.0s cubic-bezier(0.7, 0, 0.3, 1), 
            filter 1.0s ease-in, 
            opacity 1.0s ease-in;
        will-change: transform, filter, opacity;
      }

      /* --- THE BOMBASTIC EXIT STATE --- */
      #_universal_loader.loaded .wave-container {
        transform: scale(15); /* Infinite Zoom */
        /* COMBINATION OF EFFECTS:
           1. Blur: Simulates extreme speed
           2. Brightness 600%: The "Flash" (Light Source)
           3. Drop-shadow: Adds the glowing aura
        */
        filter: blur(8px) brightness(90000%) drop-shadow(0 4px 30px rgba(0,0,0,1));
        opacity: 0.8;
        color: #000000;
      }

      /* --- WARP SPEED ACCELERATION --- */
      /* When loaded, we override the animation duration to be incredibly fast (0.2s) */
      #_universal_loader.loaded .wave1 { animation: wave_loop 0.2s linear infinite !important; }


      .wave-svg {
        position: absolute;
        top: 0;
        left: 0;
        width: 200%;
        height: 100%;
        fill: none;
        stroke-width: 4;
        stroke-linecap: round;
        overflow: visible;
      }

      /* Normal Speed Settings */
      .wave1 { 
          stroke: #fff; 
          opacity: 0.7; 
          animation: wave_loop 4s linear infinite;
          filter: blur(2px) drop-shadow(0 4px 30px rgba(0,0,0,1));
      }


      @keyframes wave_loop {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
      }

      #_universal_loader.loaded {
        opacity: 0;
        pointer-events: none;
      }
    `;

    const style = document.createElement('style');
    style.appendChild(document.createTextNode(css));
    document.head.appendChild(style);

    const overlay = document.createElement('div');
    overlay.id = '_universal_loader';
    
    const container = document.createElement('div');
    container.className = 'wave-container';

    const wavePath = "M0,100 C150,180 350,20 500,100 C650,180 850,20 1000,100 C1150,180 1350,20 1500,100 C1650,180 1850,20 2000,100";

    const createWave = (cls) => {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("viewBox", "0 0 1000 200");
        svg.setAttribute("preserveAspectRatio", "none");
        svg.setAttribute("class", `wave-svg ${cls}`);
        
        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        path.setAttribute("d", wavePath);
        svg.appendChild(path);
        return svg;
    };

    container.appendChild(createWave('wave1'));

    
    overlay.appendChild(container);
    document.documentElement.appendChild(overlay);

    function revealPage() {
        overlay.classList.add('loaded');
        // Wait for the 1.0s zoom/flash to finish before removing from DOM
        setTimeout(() => {
            if (overlay.parentNode) overlay.parentNode.removeChild(overlay);
        }, 2200); 
    }

    // --- NEW LOGIC START ---
    // Wrapper to handle URL check
    function checkAndReveal() {
        // Check if URL contains '?' (e.g. yyy.com/? or yyy.com?param=1)
        if (window.location.href.indexOf('?') > -1) {
            // Add extra 3 seconds throttle
            setTimeout(revealPage, 1000);
        } else {
            // No '?', reveal normally
            revealPage();
        }
    }

    if (document.readyState === 'complete') {
        checkAndReveal();
    } else {
        window.addEventListener('load', checkAndReveal);
        // Fallback: Force reveal after 8 seconds (passing through check)
        setTimeout(checkAndReveal, 8000);
    }
    // --- NEW LOGIC END ---

})();
</script><script>
  document.addEventListener("DOMContentLoaded", function() {
      // --- CONFIGURATION ---
      const storageKey = 'saved_h1_data'; 
      const targetH2Id = 'doors-hero-title'; 

      // --- HELPER: SAVE AND UPDATE ---
      function syncH1toH2() {
          // 1. Find the current H1 (fresh search every time)
          const currentH1 = document.querySelector('h1');
          const targetH2 = document.getElementById(targetH2Id);
          
          // 2. If we have an H1, save its data
          if (currentH1) {
              const newText = currentH1.innerText.trim();
              
              // Only update if it's actually different to avoid infinite loops
              if (newText && newText !== localStorage.getItem(storageKey)) {
                  localStorage.setItem(storageKey, newText);
                  if (targetH2) targetH2.innerText = newText;
              }
          }
      }

      // --- STEP 1: RESTORE IMMEDIATELY ---
      // Check memory instantly so H2 is not empty on load
      const savedData = localStorage.getItem(storageKey);
      const targetH2 = document.getElementById(targetH2Id);
      if (savedData && targetH2) {
          targetH2.innerText = savedData;
      }

      // --- STEP 2: WATCH THE WHOLE BODY ---
      // We observe 'document.body' so we catch the H1 even if it gets deleted/swapped.
      const observer = new MutationObserver(function(mutations) {
          // Whenever ANYTHING changes in the body, check if we need to sync H1
          syncH1toH2();
      });

      // Start watching everything (Text changes, new elements, etc.)
      observer.observe(document.body, { 
          childList: true, 
          subtree: true, 
          characterData: true 
      });
      
      // Run once at start to catch dynamic H1s that load fast
      syncH1toH2();
  });
</script>



    </head>
<body>
<a href="/" class="app-brand" aria-label="Tuwa Home">
    <div class="brand-icon">
        <img src="assets/ui/logo.png" alt="Tuwa Logo">
    </div>
    <span class="brand-text">Tuwa</span>
</a>

    <script src="src/utils/resolution.js"></script>
    <script src="src/components/recommendations.js"></script>
    <script src="src/components/offline-status.js"></script>
    <script src="src/utils/service-worker-registration.js"></script>
<div id="island-search-wrapper">
    <div class="island-search-box">
        <div class="search-icon-wrapper">

        </div>
        <input type="text" id="island-input" placeholder="Search anything" autocomplete="off">
    </div>

    <button id="island-trigger" class="enter-trigger" tabindex="0">
        <span class="key-hint" data-key="Enter">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path>
            </svg>
    </button>
</div>

    <nav id="tv-sidebar">
        <a href="#" class="nav-item active" id="nav-home" tabindex="1">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span class="nav-label" data-i18n="nav.home">Home</span>
        </a>
        <a href="#" class="nav-item" id="nav-search" tabindex="2">
            <svg class="nav-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            <span class="nav-label" data-i18n="nav.search">Search</span>
        </a>
        <a href="../" class="nav-item" id="nav-profile" tabindex="3">
            <div class="nav-icon profile-icon">Q</div>
            <span class="nav-label" data-i18n="nav.profile">Profile</span>
        </a>
    </nav>

    <div id="search-overlay">
        <div class="keyboard-section">
            <div id="voice-search-btn" tabindex="0" role="button" data-i18n-aria-label="search.voiceSearch" aria-label="Voice Search">
                <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
            </div>
            <div id="search-input-display"></div>
            <div class="keyboard-grid" id="keyboard-grid"></div>
        </div>
        <div class="results-section">
            <div class="row-header row-header-top-results" data-i18n="dashboard.topResults">Top Results</div>
            <div class="results-grid" id="search-results-grid">
                <div class="no-results" data-i18n="dashboard.useKeyboard">Use the keyboard to describe a topic...</div>
            </div>
        </div>
    </div>



    <div id="dashboard-view" class="active">
        <div class="hero-banner">
            <div class="hero-preview-layer" id="hero-preview-layer">
                <img id="preview-img" class="preview-img" src="" alt="">
            </div>
            <div class="hero-shadow-overlay"></div>
            <div id="hero-subtitle-overlay"></div>

            <div class="hero-content">

                <h1 class="hero-title-text" id="door-hero-title" data-i18n="hero.title"></h1>
                <div class="hero-subtitle" id="door-hero-subtitle" data-i18n="hero.subtitle"></div>
                    
                        <path d="M18.25 12L7.75 5.75V18.25L18.25 12Z" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>

        <div class="row-section row-section-hidden" id="continue-section">
            <div class="row-header" data-i18n="dashboard.continueListening">Continue Listening</div>
            <div class="card-scroller" id="continue-row"></div>
        </div>


        <div class="row-section row-section-padding-bottom">
            <div class="row-header"></div>
            <div class="card-scroller" id="all-row"></div>
        </div>
    </div>

    <audio id="preview-audio" crossorigin="anonymous"></audio>

    <div id="cinema-view">
        <div id="loading-overlay">
            <nav id="splash-footer">

                <h2 class="heroz-title-text" id="doors-hero-title"></h2>
            </nav>
            <div class="loader-content">
                <div class="loader-spinner"></div>
                <div class="loader-text" id="loader-text"></div>
                <button id="start-btn" class="start-btn" data-i18n="player.start">Start</button>
            </div>


        </div>

        <div class="container">
            <audio id="audio-player" crossorigin="anonymous"></audio>
            <audio id="translation-audio-player" crossorigin="anonymous"></audio>

            <h1 id="chapter-title" data-i18n="player.title"></h1>
            
            <div id="content-display">
                <div id="verse-container">
                    <div id="buffering-indicator"></div>
                    <img id="verse-text" class="active-verse-img" alt="Verse" width="600" height="300" loading="eager">
                    <img id="verse-text-next" alt="Next Verse" width="600" height="300" loading="lazy">
                </div>
                <div id="translation-text" dir="auto" data-i18n="loading.selectSurah">Select a Surah...</div>
            </div>
        </div>

        <div id="control-panel">
            <div id="chapterSelectWrapper" class="custom-select-wrapper">
                <button class="custom-select-trigger" tabindex="0" data-i18n="player.selectSurahButton"><span>Select Surah</span></button>
                <div class="custom-options"></div>
            </div>
            
            <div id="verseSelectWrapper" class="custom-select-wrapper">
                <button class="custom-select-trigger" tabindex="0" data-i18n="player.ayah"><span>Ayah</span></button>
                <div class="custom-options"></div>
            </div>

            <div id="reciterSelectWrapper" class="custom-select-wrapper">
                <button class="custom-select-trigger" tabindex="0" data-i18n="player.reciter"><span>Reciter</span></button>
                <div class="custom-options"></div>
            </div>

            <div id="translationSelectWrapper" class="custom-select-wrapper">
                <button class="custom-select-trigger" tabindex="0" data-i18n="player.translation"><span>Translation</span></button>
                <div class="custom-options"></div>
            </div>

            <div id="translationAudioSelectWrapper" class="custom-select-wrapper">
                <button class="custom-select-trigger" tabindex="0" data-i18n="player.audioTrans"><span>Audio Translation</span></button>
                <div class="custom-options"></div>
            </div>
        </div>
    </div>

    <div id="arabic-modal">
        <div class="arabic-modal-card">
            <h2><b data-i18n="arabicModal.question">Do you know how to read Arabic?</b></h2>
            <h3 data-i18n="arabicModal.subtitle">Or you'll simply see only the translation.</h3>
            <div class="arabic-btn-group">
                <button id="btn-arabic-yes" class="arabic-btn" data-i18n="arabicModal.yes">Yes</button>
                <button id="btn-arabic-no" class="arabic-btn" data-i18n="arabicModal.no">No</button>
            </div>
        </div>
    </div>
    <script src="src/core/app.js"></script>
    <script src="src/core/ai-override.js"></script> 
    <script src="src/components/navigation.js"></script> <script src="src/components/arabic-modal-handler.js"></script>
    <script src="src/components/search/voice-search-bridge.js"></script>
    <script src="src/utils/content-protection.js"></script>
    <script src="src/components/search/grid-navigation.js"></script>
    <script src="src/ui/artifact.js"></script>
    <script src="src/ui/all-text-fade.js"></script>
    <div id="transition-fade-layer"></div>
<div id="trojan-landing" style="display: none;"> 
    <div class="trojan-brand-replica">
        <img src="assets/ui/logo.png" alt="Tuwa Logo">
        <span>Tuwa</span>
    </div>

    <div class="trojan-content">
        <a href="/" class="appx-brand" aria-label="Tuwa Home">
            <div class="brand-icon">
                <img src="assets/ui/logo.png" alt="Tuwa Logo">
            </div>
            <span class="brand-text">Tuwa</span>
        </a>
        
        <h1 class="trojan-title">Listen to premium content with distraction-free viewing.</h1>
        <p class="trojan-subtitle">Premium streaming provider — Join 700 million listeners</p>

        <div class="trojan-price-tag">
            <span class="price-big">USD 0.00</span>
            <span class="price-term">/ First 60 Months</span>
        </div>

        <button id="trojan-start-btn" class="trojan-btn">Start watching for free</button>

        <p class="trojan-legal-disclaimer">
            *Promotional pricing of USD 0.00/mo valid for the initial 60-month term. Plan automatically continues at the standard zero-cost rate thereafter. No commitment; cancel anytime. No payment method required.
        </p>
    </div>

    <div class="trojan-processing">
        <div class="trojan-loader"></div>
        <div class="trojan-status-text" id="trojan-status">Confirming availability</div>
    </div>

    <div class="trojan-footer">
        <div class="trojan-legal-links">
            <span>Privacy Policy</span>
            <span>Terms of Use</span>
            <span>Cookie Preferences</span>
            <span>Corporate Information</span>
            <span>Regulatory Compliance</span>
        </div>
        <p>© 2024-2026 Tuwa Media. All Rights Reserved. Tuwa and OpenTuwa are trademarks of Tuwa Media.</p>
    </div>
</div>

<script>
(function() {
    // --- 0. IMMEDIATE VISUAL CONTROL ---
    const TROJAN_KEY = 'tuwa_user_onboarded';
    const CURRENCY_KEY = 'tuwa_user_currency';
    const isReturningUser = localStorage.getItem(TROJAN_KEY);
    
    // Immediate DOM Elements
    const trojanLayer = document.getElementById('trojan-landing');
    const islandSearch = document.getElementById('island-search-wrapper');

    const toggleIsland = (hide) => {
        if (!islandSearch) return;
        const style = islandSearch.style;
        if (hide) {
            style.setProperty('display', 'none', 'important');
            style.setProperty('visibility', 'hidden', 'important');
            style.setProperty('opacity', '0', 'important');
            style.setProperty('z-index', '-1', 'important');
        } else {
            style.removeProperty('display');
            style.removeProperty('visibility');
            style.removeProperty('opacity');
            style.removeProperty('z-index');
        }
    };

    if (!isReturningUser) {
        if (trojanLayer) trojanLayer.style.display = 'flex';
        toggleIsland(true);
    } else {
        if (trojanLayer) trojanLayer.remove();
        toggleIsland(false);
        return; 
    }

    // --- 1. DATASET: COUNTRY CODE -> CURRENCY ---
    const currencyMap = {
        'AF': 'AFN', 'AL': 'ALL', 'DZ': 'DZD', 'AD': 'EUR', 'AO': 'AOA', 'AG': 'XCD', 'AR': 'ARS', 'AM': 'AMD', 'AU': 'AUD', 'AT': 'EUR', 'AZ': 'AZN',
        'BS': 'BSD', 'BH': 'BHD', 'BD': 'BDT', 'BB': 'BBD', 'BY': 'BYN', 'BE': 'EUR', 'BZ': 'BZD', 'BJ': 'XOF', 'BT': 'BTN', 'BO': 'BOB', 'BA': 'BAM', 'BW': 'BWP', 'BR': 'BRL', 'BN': 'BND', 'BG': 'BGN', 'BF': 'XOF', 'BI': 'BIF',
        'CV': 'CVE', 'KH': 'KHR', 'CM': 'XAF', 'CA': 'CAD', 'CF': 'XAF', 'TD': 'XAF', 'CL': 'CLP', 'CN': 'CNY', 'CO': 'COP', 'KM': 'KMF', 'CG': 'XAF', 'CD': 'CDF', 'CR': 'CRC', 'CI': 'XOF', 'HR': 'EUR', 'CU': 'CUP', 'CY': 'EUR', 'CZ': 'CZK',
        'DK': 'DKK', 'DJ': 'DJF', 'DM': 'XCD', 'DO': 'DOP',
        'EC': 'USD', 'EG': 'EGP', 'SV': 'USD', 'GQ': 'XAF', 'ER': 'ERN', 'EE': 'EUR', 'SZ': 'SZL', 'ET': 'ETB',
        'FJ': 'FJD', 'FI': 'EUR', 'FR': 'EUR', 'FM': 'USD',
        'GA': 'XAF', 'GM': 'GMD', 'GE': 'GEL', 'DE': 'EUR', 'GH': 'GHS', 'GR': 'EUR', 'GD': 'XCD', 'GT': 'GTQ', 'GN': 'GNF', 'GW': 'XOF', 'GY': 'GYD',
        'HT': 'HTG', 'HN': 'HNL', 'HU': 'HUF',
        'IS': 'ISK', 'IN': 'INR', 'ID': 'IDR', 'IR': 'IRR', 'IQ': 'IQD', 'IE': 'EUR', 'IL': 'ILS', 'IT': 'EUR',
        'JM': 'JMD', 'JP': 'JPY', 'JO': 'JOD',
        'KZ': 'KZT', 'KE': 'KES', 'KI': 'AUD', 'KP': 'KPW', 'KR': 'KRW', 'KW': 'KWD', 'KG': 'KGS',
        'LA': 'LAK', 'LV': 'EUR', 'LB': 'LBP', 'LS': 'LSL', 'LR': 'LRD', 'LY': 'LYD', 'LI': 'CHF', 'LT': 'EUR', 'LU': 'EUR', 'LC': 'XCD',
        'MG': 'MGA', 'MW': 'MWK', 'MY': 'MYR', 'MV': 'MVR', 'ML': 'XOF', 'MT': 'EUR', 'MH': 'USD', 'MR': 'MRU', 'MU': 'MUR', 'MX': 'MXN', 'MD': 'MDL', 'MC': 'EUR', 'MN': 'MNT', 'ME': 'EUR', 'MA': 'MAD', 'MZ': 'MZN', 'MM': 'MMK',
        'NA': 'NAD', 'NR': 'AUD', 'NP': 'NPR', 'NL': 'EUR', 'NZ': 'NZD', 'NI': 'NIO', 'NE': 'XOF', 'NG': 'NGN', 'MK': 'MKD', 'NO': 'NOK',
        'OM': 'OMR',
        'PK': 'PKR', 'PW': 'USD', 'PA': 'USD', 'PG': 'PGK', 'PY': 'PYG', 'PE': 'PEN', 'PH': 'PHP', 'PL': 'PLN', 'PT': 'EUR',
        'QA': 'QAR',
        'RO': 'RON', 'RU': 'RUB', 'RW': 'RWF',
        'KN': 'XCD', 'VC': 'XCD', 'WS': 'WST', 'SM': 'EUR', 'ST': 'STN', 'SA': 'SAR', 'SN': 'XOF', 'RS': 'RSD', 'SC': 'SCR', 'SL': 'SLE', 'SG': 'SGD', 'SK': 'EUR', 'SI': 'EUR', 'SB': 'SBD', 'SO': 'SOS', 'ZA': 'ZAR', 'SS': 'SSP', 'ES': 'EUR', 'LK': 'LKR', 'SD': 'SDG', 'SR': 'SRD', 'SE': 'SEK', 'CH': 'CHF', 'SY': 'SYP',
        'TJ': 'TJS', 'TZ': 'TZS', 'TH': 'THB', 'TL': 'USD', 'TG': 'XOF', 'TO': 'TOP', 'TT': 'TTD', 'TN': 'TND', 'TR': 'TRY', 'TM': 'TMT', 'TV': 'AUD',
        'UG': 'UGX', 'UA': 'UAH', 'AE': 'AED', 'GB': 'GBP', 'US': 'USD', 'UY': 'UYU', 'UZ': 'UZS',
        'VU': 'VUV', 'VE': 'VES', 'VN': 'VND',
        'YE': 'YER',
        'ZM': 'ZMW', 'ZW': 'ZWG',
        'HK': 'HKD', 'TW': 'TWD', 'PS': 'ILS', 'XK': 'EUR'
    };

    // --- 2. COMPREHENSIVE TIMEZONE RESOLVER (190+ REGIONS) ---
    const resolveCurrencyFromTimezone = () => {
        try {
            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (!tz) return null;

            // --- ASIA ---
            if (tz.includes('Jakarta') || tz.includes('Makassar') || tz.includes('Pontianak') || tz.includes('Jayapura')) return 'IDR';
            if (tz.includes('Kuala_Lumpur') || tz.includes('Kuching')) return 'MYR';
            if (tz.includes('Singapore')) return 'SGD';
            if (tz.includes('Bangkok')) return 'THB';
            if (tz.includes('Ho_Chi_Minh')) return 'VND';
            if (tz.includes('Manila')) return 'PHP';
            if (tz.includes('Tokyo')) return 'JPY';
            if (tz.includes('Seoul')) return 'KRW';
            if (tz.includes('Shanghai') || tz.includes('Urumqi') || tz.includes('Beijing')) return 'CNY';
            if (tz.includes('Hong_Kong')) return 'HKD';
            if (tz.includes('Taipei')) return 'TWD';
            if (tz.includes('Kolkata') || tz.includes('Calcutta')) return 'INR';
            if (tz.includes('Karachi')) return 'PKR';
            if (tz.includes('Dhaka')) return 'BDT';
            if (tz.includes('Colombo')) return 'LKR';
            if (tz.includes('Kathmandu')) return 'NPR';
            if (tz.includes('Kabul')) return 'AFN';
            if (tz.includes('Tashkent')) return 'UZS';
            if (tz.includes('Almaty') || tz.includes('Qyzylorda')) return 'KZT';
            if (tz.includes('Bishkek')) return 'KGS';
            if (tz.includes('Dushanbe')) return 'TJS';
            if (tz.includes('Ashgabat')) return 'TMT';
            if (tz.includes('Ulaanbaatar')) return 'MNT';
            if (tz.includes('Phnom_Penh')) return 'KHR';
            if (tz.includes('Vientiane')) return 'LAK';
            if (tz.includes('Yangon')) return 'MMK';
            if (tz.includes('Thimphu')) return 'BTN';
            if (tz.includes('Male')) return 'MVR';

            // --- MIDDLE EAST ---
            if (tz.includes('Riyadh')) return 'SAR';
            if (tz.includes('Dubai')) return 'AED';
            if (tz.includes('Kuwait')) return 'KWD';
            if (tz.includes('Qatar')) return 'QAR';
            if (tz.includes('Bahrain')) return 'BHD';
            if (tz.includes('Muscat')) return 'OMR';
            if (tz.includes('Amman')) return 'JOD';
            if (tz.includes('Beirut')) return 'LBP';
            if (tz.includes('Jerusalem') || tz.includes('Gaza') || tz.includes('Hebron')) return 'ILS'; 
            if (tz.includes('Baghdad')) return 'IQD';
            if (tz.includes('Tehran')) return 'IRR';
            if (tz.includes('Damascus')) return 'SYP';
            if (tz.includes('Aden')) return 'YER';

            // --- EUROPE ---
            if (tz.includes('London')) return 'GBP';
            if (tz.includes('Istanbul')) return 'TRY';
            if (tz.includes('Moscow') || tz.includes('Volgograd') || tz.includes('Novosibirsk')) return 'RUB';
            if (tz.includes('Kyiv') || tz.includes('Kiev')) return 'UAH';
            if (tz.includes('Minsk')) return 'BYN';
            if (tz.includes('Chisinau')) return 'MDL';
            if (tz.includes('Zurich') || tz.includes('Geneva')) return 'CHF';
            if (tz.includes('Oslo')) return 'NOK';
            if (tz.includes('Stockholm')) return 'SEK';
            if (tz.includes('Copenhagen')) return 'DKK';
            if (tz.includes('Reykjavik')) return 'ISK';
            if (tz.includes('Tirane')) return 'ALL';
            if (tz.includes('Sarajevo')) return 'BAM';
            if (tz.includes('Skopje')) return 'MKD';
            if (tz.includes('Belgrade')) return 'RSD';
            if (tz.includes('Budapest')) return 'HUF';
            if (tz.includes('Prague')) return 'CZK';
            if (tz.includes('Warsaw')) return 'PLN';
            if (tz.includes('Bucharest')) return 'RON';
            if (tz.includes('Sofia')) return 'BGN';
            if (tz.includes('Paris') || tz.includes('Berlin') || tz.includes('Rome') || tz.includes('Madrid') || tz.includes('Amsterdam') || tz.includes('Brussels') || tz.includes('Vienna') || tz.includes('Lisbon') || tz.includes('Athens') || tz.includes('Helsinki') || tz.includes('Dublin') || tz.includes('Bratislava') || tz.includes('Ljubljana') || tz.includes('Tallinn') || tz.includes('Riga') || tz.includes('Vilnius')) return 'EUR';

            // --- AFRICA ---
            if (tz.includes('Cairo')) return 'EGP';
            if (tz.includes('Lagos')) return 'NGN';
            if (tz.includes('Johannesburg')) return 'ZAR';
            if (tz.includes('Nairobi')) return 'KES';
            if (tz.includes('Accra')) return 'GHS';
            if (tz.includes('Algiers')) return 'DZD';
            if (tz.includes('Casablanca')) return 'MAD';
            if (tz.includes('Tunis')) return 'TND';
            if (tz.includes('Addis_Ababa')) return 'ETB';
            if (tz.includes('Khartoum')) return 'SDG';
            if (tz.includes('Dar_es_Salaam')) return 'TZS';
            if (tz.includes('Kampala')) return 'UGX';
            if (tz.includes('Kigali')) return 'RWF';
            if (tz.includes('Tripoli')) return 'LYD';
            if (tz.includes('Luanda')) return 'AOA';
            if (tz.includes('Maputo')) return 'MZN';
            if (tz.includes('Harare')) return 'ZWG';
            if (tz.includes('Lusaka')) return 'ZMW';
            if (tz.includes('Windhoek')) return 'NAD';
            if (tz.includes('Gaborone')) return 'BWP';
            if (tz.includes('Port_Louis')) return 'MUR';

            // --- AMERICAS ---
            if (tz.includes('New_York') || tz.includes('Los_Angeles') || tz.includes('Chicago') || tz.includes('Denver') || tz.includes('Phoenix')) return 'USD';
            if (tz.includes('Toronto') || tz.includes('Vancouver')) return 'CAD';
            if (tz.includes('Mexico_City')) return 'MXN';
            if (tz.includes('Sao_Paulo') || tz.includes('Rio_Branco')) return 'BRL';
            if (tz.includes('Buenos_Aires')) return 'ARS';
            if (tz.includes('Santiago')) return 'CLP';
            if (tz.includes('Bogota')) return 'COP';
            if (tz.includes('Lima')) return 'PEN';
            if (tz.includes('Caracas')) return 'VES';
            if (tz.includes('La_Paz')) return 'BOB';
            if (tz.includes('Asuncion')) return 'PYG';
            if (tz.includes('Montevideo')) return 'UYU';
            if (tz.includes('Guatemala')) return 'GTQ';
            if (tz.includes('San_Jose')) return 'CRC';
            if (tz.includes('Santo_Domingo')) return 'DOP';
            if (tz.includes('Port-au-Prince')) return 'HTG';
            if (tz.includes('Kingston')) return 'JMD';
            if (tz.includes('Havana')) return 'CUP';

            // --- OCEANIA ---
            if (tz.includes('Sydney') || tz.includes('Melbourne') || tz.includes('Perth') || tz.includes('Brisbane')) return 'AUD';
            if (tz.includes('Auckland')) return 'NZD';
            if (tz.includes('Fiji')) return 'FJD';
            if (tz.includes('Port_Moresby')) return 'PGK';

            return null; 
        } catch (e) {
            return null;
        }
    };

    // --- 3. MASTER RESOLUTION ---
    const resolveCurrency = () => {
        let detected = 'USD'; // Default

        // 1. Check Cache
        const cached = localStorage.getItem(CURRENCY_KEY);
        if (cached && cached !== '0' && cached !== 'null' && cached !== 'undefined') {
            return cached;
        }

        // 2. Check Detailed Timezone (Best Match)
        const tzCurrency = resolveCurrencyFromTimezone();
        if (tzCurrency) detected = tzCurrency;

        // 3. Fallback to Language Region (if Timezone failed)
        else {
            try {
                const lang = navigator.language;
                if (lang.includes('-')) {
                    const region = lang.split('-')[1].toUpperCase();
                    if (currencyMap[region]) detected = currencyMap[region];
                }
            } catch(e) {}
        }

        // --- FAILSAFE: ZERO TOLERANCE ---
        // If for any reason the result is 0, null, undefined, or empty -> FORCE USD
        if (!detected || detected === 0 || detected === '0' || detected === 'null' || detected === 'undefined') {
            return 'USD';
        }

        return detected;
    };

    // --- 4. UI PAINTER ---
    const paintUI = (currencyCode) => {
        // --- FAILSAFE: FINAL CHECK ---
        // Even if resolveCurrency passes, we double check here before painting
        if (!currencyCode || currencyCode === 0 || currencyCode === '0' || currencyCode === 'null') {
            currencyCode = 'USD';
        }

        // Format Price
        try {
            const formatter = new Intl.NumberFormat(navigator.language, {
                style: 'currency',
                currency: currencyCode,
                minimumFractionDigits: 2
            });
            const priceTag = document.querySelector('.price-big');
            if (priceTag) priceTag.innerText = formatter.format(0);
        } catch (e) {
            // If Intl fails (e.g. invalid code), fallback manually
            const priceTag = document.querySelector('.price-big');
            if (priceTag) priceTag.innerText = currencyCode + " 0.00";
        }

        // Update Legal Text
        const legalText = document.querySelector('.trojan-legal-disclaimer');
        if (legalText) {
            const regex = /\b([A-Z]{3})\b/g; 
            legalText.innerHTML = legalText.innerHTML.replace(regex, (match) => {
                const knownCurrencies = Object.values(currencyMap);
                // Only replace if it matches a known currency or USD
                if (knownCurrencies.includes(match) || match === 'USD') {
                    return currencyCode;
                }
                return match;
            });
        }
    };

    // --- 5. EXECUTION ---
    const estimatedCurrency = resolveCurrency();
    paintUI(estimatedCurrency);

    // Async Check (Only save if valid)
    fetch('https://ipapi.co/json/')
        .then(res => res.json())
        .then(data => {
            if (data && data.country_code) {
                const realCurrency = currencyMap[data.country_code.toUpperCase()];
                
                // STRICT CHECK: Only update if valid currency
                if (realCurrency && realCurrency !== '0' && realCurrency !== 0) {
                    localStorage.setItem(CURRENCY_KEY, realCurrency);
                    if (realCurrency !== estimatedCurrency) {
                        paintUI(realCurrency);
                    }
                }
            }
        })
        .catch(() => {
            // If API Fails, we do nothing. We rely on the Safe Estimate.
        });

    // --- 6. INTERACTION ---
    const startBtn = document.getElementById('trojan-start-btn');
    const footer = document.querySelector('.trojan-footer');
    const trojanContent = document.querySelector('.trojan-content');
    const trojanProcessing = document.querySelector('.trojan-processing');
    const statusText = document.getElementById('trojan-status');

    if (startBtn) {
        let touchStartY = 0;
        const handleScroll = (deltaY) => {
            if (!footer) return;
            if (deltaY > 5) footer.classList.add('footer-reveal');
            else if (deltaY < -5) footer.classList.remove('footer-reveal');
        };

        window.addEventListener('wheel', (e) => handleScroll(e.deltaY));
        window.addEventListener('touchstart', (e) => touchStartY = e.touches[0].clientY, { passive: true });
        window.addEventListener('touchmove', (e) => {
            const diff = touchStartY - e.touches[0].clientY;
            if (Math.abs(diff) > 20) {
                handleScroll(diff);
                touchStartY = e.touches[0].clientY; 
            }
        }, { passive: true });

// ... inside your startBtn event listener ...

    startBtn.addEventListener('click', function() {
        // 1. Set the flag
        localStorage.setItem(TROJAN_KEY, 'true');
        
        // 2. Disconnect the Anti-Tamper Watchdog (So we can actually modify DOM now)
        // (You need to move 'antiTamper' variable scope so it's accessible here, 
        // or just define the observer globally inside the IIFE)
        // antiTamper.disconnect(); 

        // 3. UI Animations
        if (trojanContent) trojanContent.classList.add('content-hidden');
        if (footer) footer.classList.remove('footer-reveal'); 
        if (trojanProcessing) trojanProcessing.classList.add('active');

        // ... Your delay steps array ...
// 1. Define the simulation steps to make it look real
        const steps = [
            { msg: "Verifying geolocation...", delay: 1000 },
            { msg: "Allocating server...", delay: 2200 },
            { msg: "Finalizing setup...", delay: 3500 }
        ];

        // 2. Define the total wait time (must be longer than the last step)
        const totalDelay = 4500; 

        // 3. Run the visual updates
        steps.forEach(step => {
            setTimeout(() => {
                if (statusText) statusText.innerText = step.msg;
            }, step.delay);
        });

        // 4. THE HANDOVER (Crucial Fix)
        setTimeout(() => {
            // First: Fade out the Trojan visual
            if (trojanLayer) {
                trojanLayer.classList.add('trojan-hidden');
            }

            // Second: WAIT for the visual fade to finish (800ms)
            setTimeout(() => {
                // NOW we lift the Iron Curtain.
                // The dashboard was `display: none` this whole time.
                // Now it pops into existence.
                document.body.classList.remove('trojan-lockdown');
// 2. Snap to Element
targetCard.scrollIntoView({ behavior: 'auto', block: 'center' });
                
                // Remove the Trojan DOM element entirely
                if (trojanLayer) trojanLayer.remove();
                
                // Allow interaction again
                toggleIsland(false); 
                
                // Optional: Trigger a resize event to force dashboard layout recalculation
                window.dispatchEvent(new Event('resize'));

            }, 800); // Matches your CSS transition time

        }, totalDelay + 800); 
    });

    }
})();

(function() {
    // --- 0. IMMEDIATE LOCKDOWN ---
    const TROJAN_KEY = 'tuwa_user_onboarded';
    const isReturningUser = localStorage.getItem(TROJAN_KEY);
    const body = document.body;
    
    // If not onboarded, IMMEDIATELY apply the lockdown class
    if (!isReturningUser) {
        body.classList.add('trojan-lockdown');
    } else {
        // If returning, remove the HTML entirely to free up memory
        const landing = document.getElementById('trojan-landing');
        if (landing) landing.remove();
        return; // Exit script, let dashboard load
    }

    // --- 1. ANTI-TAMPER MECHANISM (The "DRM") ---
    // If someone tries to delete the overlay or remove the class via Console/Inspect
    const antiTamper = new MutationObserver((mutations) => {
        const landing = document.getElementById('trojan-landing');
        
        // Check 1: Did someone delete the landing div?
        if (!landing) {
            // Punishment: Reload page immediately
            window.location.reload(); 
            return;
        }

        // Check 2: Did someone remove the lockdown class from body?
        if (!body.classList.contains('trojan-lockdown') && !localStorage.getItem(TROJAN_KEY)) {
            // Re-apply immediately
            body.classList.add('trojan-lockdown');
        }

        // Check 3: Did someone try to hide the landing div via inline style?
        if (landing.style.display === 'none' || landing.style.opacity === '0' || landing.style.visibility === 'hidden') {
             // Force it back
             landing.setAttribute('style', 'display: flex !important; opacity: 1 !important; visibility: visible !important;');
        }
    });

    // Start watching the DOM for structural changes
    antiTamper.observe(document.documentElement, {
        childList: true,
        attributes: true,
        subtree: true,
        attributeFilter: ['class', 'style']
    });

    // Disable Right Click (Optional, adds to the "DRM" feel)
    document.addEventListener('contextmenu', event => event.preventDefault());

    // ... REST OF YOUR EXISTING CURRENCY LOGIC HERE ...
})();
</script>
</body>
</html>