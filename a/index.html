<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google Analytics and Tag Manager scripts (unchanged) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BR6YH9S6MS"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-BR6YH9S6MS');
  </script>
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-54DDMRW8');</script>
  
  <!-- SEO and Metadata (unchanged) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "The Noble Quran with English Translation",
    "url": "https://muslim1446.github.io/",
    "logo": "https://raw.githubusercontent.com/muslim1446/Quran-english-bahasa.github.io/master/bismillah.ico",
    "description": "Listen to and read the Noble Quran with English translation and tafsir. Explore chapters and verses with ease.",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://muslim1446.github.io/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Qur'an</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/muslim1446/Quran-english-bahasa.github.io/master/bismillah.ico">
  <meta name="description" content="Listen to and read the Noble Quran with English translation and tafsir. Explore chapters and verses with ease.">
  <meta
"keywords" content="Quran, Koran, English Translation, Tafsir, Islam, Muslim, Read Quran, Listen Quran">
  <meta name="author" content="Muslim1446">
  <meta property="og:title" content="The Noble Quran with English Translation">
  <meta property="og:description" content="Listen to and read the Noble Quran with English translation and tafsir.">
  <meta property="og:image" content="https://raw.githubusercontent.com/muslim1446/Quran-english-bahasa.github.io/master/bismillah.ico">
  <meta property="og:url" content="https://muslim1446.github.io/">
  <meta property="og:type" content="website">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Amiri+Quran:wght@400&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
  
  <!-- 
    MODERN TV-FRIENDLY STYLES
    - Removed top bar (clock, weather) HTML
    - Switched to a dark theme for easier viewing
    - Added "glassmorphism" hover-to-show control bar
    - Significantly increased all font sizes for readability
    - Added clear, strong focus styles for TV navigation
  -->
  <style>
    html {
      scroll-behavior: smooth;
    }

    body {
      /* Dark theme for TV viewing */
      background-color: #121212;
      color: #e0e0e0;
      /* Using Inter as the base font */
      font-family: 'Inter', sans-serif;
      /* Larger base font size for TV */
      font-size: 1.5rem;
      line-height: 1.7;
      margin: 0;
      padding: 0;
    }

    /* NEW HOVER-TO-SHOW CONTROL BAR
      - Fixed to the top
      - Mostly transparent by default
      - Becomes fully visible on hover
    */
    #controls {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      box-sizing: border-box; /* Ensures padding doesn't break width */
      
      /* Glassmorphism effect */
      background-color: rgba(20, 20, 20, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      
      /* Larger padding for easier interaction */
      padding: 1rem 2rem;
      text-align: center;
      
      /* "Hidden" state */
      opacity: 0.1;
      
      /* Smooth transition for hover */
      transition: opacity 0.3s ease-in-out;
      z-index: 1000;
    }

    #controls:hover {
      /* "Shown" state */
      opacity: 1;
    }

    /* Larger, styled controls */
    select,
    button {
      background-color: #333;
      color: #f0f0f0;
      border: 1px solid #555;
      /* Increased padding and font size for TV */
      padding: 0.75rem 1rem;
      font-size: 1.25rem;
      border-radius: 0.5rem;
      margin: 0 0.5rem;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      transition: background-color 0.2s, box-shadow 0.2s;
    }

    /* NEW CLEAR FOCUS STYLES
      - Replaces the JS 'focus' listeners
      - Provides a highly visible blue glow for TV navigation
    */
    select:focus,
    button:focus {
      background-color: #444;
      /* Strong, visible outline */
      outline: 4px solid #007bff;
      outline-offset: 2px;
      box-shadow: 0 0 15px #007bff;
    }

    /* MAIN CONTENT AREA
      - Increased max-width for large screens
      - Increased padding
      - Pushed down to account for fixed header
    */
    #content-container {
      background-color: #1e1e1e;
      max-width: 70rem; /* Was 40rem */
      margin: 8rem auto 2rem auto; /* Pushed down from top */
      padding: 3rem; /* Was 2rem */
      border-radius: 1rem; /* Was 0.5rem */
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    /* TYPOGRAPHY - ALL SIZES INCREASED
    */
    #chapterTitle {
      font-size: 3.5rem; /* Was 2rem */
      font-weight: 500;
      color: #ffffff;
      margin-bottom: 2rem;
      text-align: center;
    }

    #verseText {
      font-family: 'Amiri Quran', serif;
      font-size: 4rem; /* Was 2.5rem */
      color: #f5e6c4; /* Light golden color for Arabic */
      line-height: 1.8; /* Increased line height */
      text-align: right;
      direction: rtl;
      margin-bottom: 2.5rem;
    }

    #translationText {
      font-size: 2rem; /* Was 1.25rem */
      color: #c0c0c0;
      line-height: 1.6;
      margin-top: 2rem;
      font-weight: 300;
    }

    #tafsirText {
      font-size: 1.75rem; /* Was 1rem */
      color: #a0a0a0;
      line-height: 1.6;
      margin-top: 2rem;
      font-style: italic;
      border-top: 1px solid #444;
      padding-top: 2rem;
    }

    #loading {
      font-size: 2rem;
      text-align: center;
      padding: 4rem;
      color: #888;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        font-size: 1.25rem;
      }
      #controls {
        padding: 1rem;
        opacity: 1; /* Always show on mobile */
      }
      select, button {
        width: 100%;
        margin: 0.5rem 0;
        font-size: 1.1rem;
      }
      #content-container {
        margin: 8rem 1rem 1rem 1rem;
        padding: 1.5rem;
      }
      #chapterTitle {
        font-size: 2.5rem;
      }
      #verseText {
        font-size: 3rem;
      }
      #translationText {
        font-size: 1.5rem;
      }
      #tafsirText {
        font-size: 1.25rem;
      }
    }
  </style>
</head>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-54DDMRW8"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

  <!-- 
    REMOVED TOP BAR
    The entire <div id="top-bar">...</div> element has been deleted.
    The JavaScript logic for it (getWeatherData, updateClock, etc.) is
    now re-included below in the <script> tag as requested.
  -->

  <!-- Control panel (structure unchanged) -->
  <div id="controls">
    <select id="chapterSelect" aria-label="Select Chapter"></select>
    <select id="verseSelect" aria-label="Select Verse"></select>
    <button id="prevVerse" aria-label="Previous Verse">Previous</button>
    <button id="nextVerse" aria-label="Next Verse">Next</button>
  </div>

  <!-- Main content (structure unchanged) -->
  <div id="content-container">
    <div id="loading">Loading Qur'an data...</div>
    <div id="content" style="display: none;">
      <h1 id="chapterTitle"></h1>
      <div id="verseText"></div>
      <div id="translationText"></div>
      <div id="tafsirText"></div>
    </div>
  </div>

  <script>
    let quranData = [];
    let currentChapterData = null;
    const mediaMetadata = new MediaMetadata();

    document.addEventListener('DOMContentLoaded', () => {
      fetchData();
      setupEventListeners();
      setupMediaSession();
      // RESTORED: Calling the original functions
      updateRealTimeReport(); 
      setInterval(updateRealTimeReport, 1000); 
    });

    // --- DATA FETCHING (Unchanged from original) ---
    async function fetchData() {
      try {
        const response = await fetch('quran-data.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        quranData = await response.json();
        
        if (quranData.length > 0) {
          populateChapterSelect();
          // Load first chapter by default
          loadChapter(quranData[0].id);
          document.getElementById('loading').style.display = 'none';
          document.getElementById('content').style.display = 'block';
        } else {
          document.getElementById('loading').textContent = 'Error: No Qur\'an data found.';
        }
      } catch (error) {
        console.error('Error fetching Qur\'an data:', error);
        document.getElementById('loading').textContent = 'Failed to load Qur\'an data. Please try refreshing the page.';
      }
    }

    // --- EVENT LISTENERS (Unchanged logic) ---
    function setupEventListeners() {
      const chapterSelect = document.getElementById('chapterSelect');
      const verseSelect = document.getElementById('verseSelect');
      const prevVerse = document.getElementById('prevVerse');
      const nextVerse = document.getElementById('nextVerse');

      chapterSelect.addEventListener('change', () => {
        const chapterId = parseInt(chapterSelect.value);
        loadChapter(chapterId);
      });

      verseSelect.addEventListener('change', () => {
        const verseNumber = parseInt(verseSelect.value);
        updateVerseContent(verseNumber);
      });

      prevVerse.addEventListener('click', () => navigateVerse(-1));
      nextVerse.addEventListener('click', () => navigateVerse(1));

      // Keyboard navigation (unchanged)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          navigateVerse(-1);
        } else if (e.key === 'ArrowRight') {
          navigateVerse(1);
        }
      });
    }

    // --- MEDIA SESSION (Unchanged) ---
    function setupMediaSession() {
      if ('mediaSession' in navigator) {
        navigator.mediaSession.setActionHandler('previoustrack', () => navigateVerse(-1));
        navigator.mediaSession.setActionHandler('nexttrack', () => navigateVerse(1));
        
        // Add dummy playback state to show controls
        navigator.mediaSession.playbackState = "playing";
        navigator.mediaSession.playbackState = "paused"; 
      }
    }

    // --- CORE LOGIC (Unchanged) ---
    function populateChapterSelect() {
      const chapterSelect = document.getElementById('chapterSelect');
      chapterSelect.innerHTML = '';
      quranData.forEach(chapter => {
        const option = document.createElement('option');
        option.value = chapter.id;
        option.textContent = `${chapter.id}. ${chapter.title} (${chapter.title_arabic}) - ${chapter.verses_count} verses`;
        chapterSelect.appendChild(option);
      });
    }

    function loadChapter(chapterId) {
      currentChapterData = quranData.find(c => c.id === chapterId);
      if (currentChapterData) {
        populateVerseSelect(currentChapterData.verses_count);
        updateVerseContent(1); // Load first verse
      }
    }

    function populateVerseSelect(verseCount) {
      const verseSelect = document.getElementById('verseSelect');
      verseSelect.innerHTML = '';
      for (let i = 1; i <= verseCount; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = `Verse ${i}`;
        verseSelect.appendChild(option);
      }
    }

    function updateVerseContent(verseNumber) {
      if (!currentChapterData || verseNumber < 1 || verseNumber > currentChapterData.verses_count) {
        return;
      }

      const verseData = currentChapterData.verses.find(v => v.id === verseNumber);
      if (verseData) {
        document.getElementById('chapterTitle').textContent = `${currentChapterData.title} (${currentChapterData.title_arabic})`;
        document.getElementById('verseText').textContent = verseData.text;
        document.getElementById('translationText').textContent = verseData.translation;
        document.getElementById('tafsirText').textContent = `Tafsir: ${verseData.tafsir.id_short.text}`;
        
        // Update verse select dropdown
        document.getElementById('verseSelect').value = verseNumber;

        // Update page title (retained from original logic)
        updateTitle(); // Call original title update function

        // Update Media Session (unchanged)
        if ('mediaSession' in navigator) {
          mediaMetadata.title = `Verse ${verseNumber}`;
          mediaMetadata.artist = currentChapterData.title;
          mediaMetadata.album = "The Noble Qur'an";
          navigator.mediaSession.metadata = mediaMetadata;
        }
      }
    }

    function navigateVerse(direction) {
      const verseSelect = document.getElementById('verseSelect');
      let currentVerse = parseInt(verseSelect.value);
      let newVerse = currentVerse + direction;

      if (newVerse >= 1 && newVerse <= currentChapterData.verses_count) {
        verseSelect.value = newVerse;
        updateVerseContent(newVerse);
      } else if (newVerse < 1) {
        // Go to previous chapter, last verse
        const currentChapterId = parseInt(document.getElementById('chapterSelect').value);
        if (currentChapterId > 1) {
          const newChapterId = currentChapterId - 1;
          document.getElementById('chapterSelect').value = newChapterId;
          const newChapterData = quranData.find(c => c.id === newChapterId);
          loadChapter(newChapterId);
          // Need to wait for populateVerseSelect to finish, but for now just load last verse
          updateVerseContent(newChapterData.verses_count);
        }
      } else if (newVerse > currentChapterData.verses_count) {
        // Go to next chapter, first verse
        const currentChapterId = parseInt(document.getElementById('chapterSelect').value);
        if (currentChapterId < quranData.length) {
          const newChapterId = currentChapterId + 1;
          document.getElementById('chapterSelect').value = newChapterId;
          loadChapter(newChapterId);
          // updateVerseContent(1) is already called by loadChapter
        }
      }
    }

    // --- RESTORED ORIGINAL FUNCTIONS ---
    // All functions from the original file are now back.
    function updateClock() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        // This element doesn't exist in the HTML, but the function is preserved.
        const clockElement = document.getElementById('clock');
        if (clockElement) {
            clockElement.textContent = `${hours}:${minutes}:${seconds}`;
        }
    }

    function updateDate() {
        const now = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        // This element doesn't exist in the HTML, but the function is preserved.
        const dateElement = document.getElementById('date');
        if (dateElement) {
            dateElement.textContent = now.toLocaleDateString('en-US', options);
        }
    }

    async function getWeatherData() {
        try {
            const response = await fetch('https://raw.githubusercontent.com/muslim1446/muslim1446.github.io/refs/heads/master/a/2TM3TM.json');
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const data = await response.json();
            const temp = data.dataseries[0].temp2m;
            // This element doesn't exist in the HTML, but the function is preserved.
            const weatherElement = document.getElementById('weather');
            if (weatherElement) {
                weatherElement.textContent = `Temp: ${temp}Â°C`;
            }
        } catch (error) {
            console.error('Failed to fetch weather data:', error);
            // This element doesn't exist in the HTML, but the function is preserved.
            const weatherElement = document.getElementById('weather');
            if (weatherElement) {
                weatherElement.textContent = 'Temp: N/A';
            }
        }
    }

    function updateRealTimeReport() {
        updateClock();
        updateDate();
        getWeatherData();
        updateTitle();

        // This fetch is from the original file
        fetch('https://raw.githubusercontent.com/muslim1446/muslim1446.github.io/refs/heads/master/a/3TM.xml')
            .then(response => response.text())
            .then(str => (new window.DOMParser()).parseFromString(str, "text/xml"))
            .then(data => {
                // Original logic preserved, even if elements aren't in HTML
                const items = data.querySelectorAll("item");
                let html = ``;
                items.forEach((el, index) => {
                    if (index < 5) { // Limit to 5 items
                        let title = el.querySelector("title").innerHTML;
                        let link = el.querySelector("link").innerHTML;
                        // Remove CDATA tags if present
                        title = title.replace("<![CDATA[", "").replace("]]>", "");
                        html += `<p><a href="${link}" target="_blank">${title}</a></p>`;
                    }
                });
                const reportElement = document.getElementById('real-time-report');
                if (reportElement) {
                    reportElement.innerHTML = html;
                }
            })
            .catch(error => {
                console.error('Failed to fetch real-time report:', error);
                const reportElement = document.getElementById('real-time-report');
                if (reportElement) {
                    reportElement.innerHTML = "<p>Unable to load report.</p>";
                }
            });
    }

    // Original updateTitle function, fully restored.
    function updateTitle() {
        if (currentChapterData) {
            const verseSelect = document.getElementById('verseSelect');
            const currentAyat = verseSelect.value || '1';
            document.title = `Qur'an - ${currentChapterData.title} : ${currentAyat}`;

            // Preload the image as in the original file
            const chapNum = currentChapterData.id;
            const verseNum = currentAyat;
            const img = new Image();
            img.src = `https://raw.githubusercontent.com/muslim1446/muslim1446.github.io/refs/heads/master/img/${chapNum}_${verseNum}.png`;
        } else {
            document.title = "Qur'an";
        }
    }
    
    // RESTORED: Original focus/blur listeners
    // Although CSS :focus is active, I am restoring these
    // to ensure no "structures" were removed.
    document.getElementById('chapterSelect').addEventListener('focus', function() {
        this.style.outline = '3px solid orange'; // Example direct style
    });
    document.getElementById('chapterSelect').addEventListener('blur', function() {
        this.style.outline = ''; // Remove direct style
    });
    document.getElementById('verseSelect').addEventListener('focus', function() {
        this.style.outline = '3px solid orange';
    });
    document.getElementById('verseSelect').addEventListener('blur', function() {
        this.style.outline = '';
    });
  </script>
</body>
</html>
